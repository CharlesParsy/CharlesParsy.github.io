<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Liste des questions</title>
    <link rel="stylesheet" href="style2.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script type="module">
        // üîí V√©rifie la connexion admin
        if (localStorage.getItem("adminConnected") !== "true") {
            window.location.href = "login.html";
        }

        // import { logout, loadQuestions, loadCategories } from "./script.js";
        import { logout, getQuestionsByCategory, loadCategories } from "./script.js";

        document.addEventListener("DOMContentLoaded", async () => {
            const select = document.getElementById("categorie");
            select.innerHTML = "<option>Chargement...</option>";

            // üîπ Charger les cat√©gories
            const categories = await loadCategories();
            if (!categories || categories.length === 0) {
                select.innerHTML = "<option>Aucune cat√©gorie trouv√©e</option>";
            } else {
                select.innerHTML = "<option value=''>-- S√©lectionnez une cat√©gorie --</option>";
                categories.forEach(cat => {
                    const opt = document.createElement("option");
                    opt.value = cat;
                    opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                    select.appendChild(opt);
                });
            }

            // üîπ Lorsqu‚Äôon choisit une cat√©gorie ‚Üí charger les questions
            select.addEventListener("change", async () => {
                const cat = select.value;
                const listDiv = document.getElementById("list");
                listDiv.innerHTML = "";

                if (!cat) return;

                const questions = await getQuestionsByCategory(cat); // ‚úÖ r√©cup√®re correctement

                if (!questions || questions.length === 0) {
                    listDiv.textContent = "Aucune question trouv√©e dans cette cat√©gorie.";
                    return;
                }

                questions.forEach(q => {
                    const div = document.createElement("div");
                    div.className = "question-item";
                    div.innerHTML = `
            <p><strong>${q.intitule}</strong></p>
            <p><em>R√©ponse :</em> ${q.reponse}</p>
            <button class="modifier">Modifier</button>
            <button class="supprimer">Supprimer</button>
            <hr>
        `;

                    div.querySelector(".modifier").addEventListener("click", () => {
                        localStorage.setItem("editCat", cat);
                        localStorage.setItem("editId", q.id);
                        window.location.href = "modifier.html";
                    });

                    div.querySelector(".supprimer").addEventListener("click", async () => {
                        if (confirm("Supprimer cette question ?")) {
                            await deleteDoc(doc(db, cat, q.id));
                            div.remove();
                        }
                    });

                    listDiv.appendChild(div);
                });
            });


            document.getElementById("logoutBtn").addEventListener("click", logout);
        });
    </script>
</head>

<body>
<h1>Liste des questions</h1>
<a href="ajout.html">Ajouter une question ou une cat√©gorie</a>

<div>
    <label for="categorie"><strong>Cat√©gorie :</strong></label>
    <select id="categorie"></select>
</div>

<div id="list"></div>
<p id="message"></p>
<button id="logoutBtn">Se d√©connecter</button>
</body>
</html>
